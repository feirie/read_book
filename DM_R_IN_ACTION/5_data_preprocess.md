#5数据预处理#
##缺失值处理##
```r
library(mice)
data(nhanes2)
dim(nhanes2)
sum(is.na(nhanes2))  #缺失值的数量
sum(complete.cases(nhanes2))  #完整样本的数量
md.pattern(nhanes2)  #观测数据中的缺失值情况
```
1.删除法   
这是简单有效的方法，但前提是缺失数据的比例较少，且缺失数据是随机出现的，这样删除缺失数据后对分析结果影响不大。有以下几种删除方式：    
- 删除观测样本
- 删除变量：当某个变量缺失值较多且对研究目标影响不大时，可以将整个变量整体删除。
- 使用完整原始数据分析：当数据存在较多缺失而其原始数据完整时，可以使用原始数据替代现有数据进行分析。
- 改变权重：当删除缺失数据会改变数据结构时，通过对完整数据按照不同的权重进行加权，可以降低删除缺失数据带来的偏差。
2.插补法   
删除数据虽然简单易行，但会带来信息浪费、改变数据结构等问题，因此在条件允许的情况下，找到缺失值的替代者来进行插补，尽可能还原真实数据是更好的方法。   
在插补法中，最简单的是从总体中随机抽取某个样本代替缺失样本。 
```r
sub<-which(is.na(nhanes2[,4]))  #返回数据集中第4列中为NA的行
dataTR<-nhanes2[-sub,]
dataTE<-nhanes2[sub,]
dataTE[,4]<-sample(dataTR[,4],length(dataTE[,4]),replace=T)
```
类似的，可以使用均值、中位数、四分位数等进行插补。由于随机插补和均值插补中没有利用到相关变量信息，因此会存在一定偏差，而回归模型是将需要插补变量作为因变量，其他相关变量作为自变量，通过建立回归模型预测出因变量的值对缺失变量进行插补。

```r
sub<-which(is.na(nhanes2[,4]))  #返回数据集中第4列中为NA的行
dataTR<-nhanes2[-sub,]
dataTE<-nhanes2[sub,]
lm<-lm(chl~age,data=dataTR)
nhanes2[sub,4]<-round(predict(lm,dataTE))
head(nhanes2)
```

热平台插补是指在非缺失数据集中找到一个与缺失值所在样本相似的样本（匹配样本），利用其中的观测值对缺失值进行插补。