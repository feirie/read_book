#13神经网络#
神经网络常用于两类问题：分类和回归。   
在使用神经网络时有几点需要注意：   
1.神经网络很难解释，目前还没有能对神经网络做出显而易见解释的方法学。   
2.神经网络会学习过度，在训练神经网络时一定要恰当地使用一些能严格衡量神经网络的方法，如前面提到的测试集方法和交叉验证方法等。这主要是由于神经网络太灵活、可变参数太多，如果给足够的时间，他几乎可以"记住"任何事情。   
3.除非问题非常简单，训练一个神经网络可能需要相当可观的时间才能完成。当然，一旦神经网络建立好了，用它来预测运行还是很快的。
##R中的实现##
nnet软件包是用来建立单隐藏层的前馈人工神经网络模型，同时也能用来建立多项对数线性模型。
###核心函数###
1.class.ind函数   
class.ind函数是用来对数据进行预处理的，这也正是该函数最重要以及唯一的一项功能。更具体地说，该函数是用来对建模数据中的结果变量进行处理的。该函数对结果变量的处理，其实是通过结果变量的因子变量来生成一个类指标矩阵。    
class.ind(cl) 
>* cl可以是一个因子向量，也可以是一个类别向量。

```r
v1<-c("a","b","a","c")
v2<-c(1,2,1,3)
class.ind(v1)
class.ind(v2)
```
2.nnet函数   
函数nnet是实现神经网络的核心函数，它主要用来建立单隐藏层的前馈人工神经网络模型，同时也可以用该函数建立无隐藏层的前馈人工神经网络模型。    
nnet(formula, data, weights, ...,subset, na.action, contrasts = NULL)    
nnet(x, y, weights, size, Wts, mask,linout = FALSE, entropy = FALSE, softmax = FALSE,censored = FALSE, skip = FALSE, rang = 0.7, decay = 0,maxit = 100, Hess = FALSE, trace = TRUE, MaxNWts = 1000,abstol = 1.0e-4, reltol = 1.0e-8, ...)
>* formula代表的是函数模型的形式
>* data代表的是模型中包含有变量的一组可选格式数据
>* weights代表的是各样本在模型中所占的权重，该参数的默认值为1，即各类样本按原始比例建立模型
>* subset主要用于抽取样本数据中的部分样本作为训练集，该参数所使用的数据格式为一向量，向量中的每个数代表所需要抽取样本的行数
>* x为一个矩阵或者一个格式化数据集，是建立人工神经网络模型所需要的自变量数据
>* y是建立人工神经网络模型中所需要的类别变量数据。这里的类别变量y是class.ind处理后生成的类指标矩阵
>* size代表的是隐藏层中的节点个数。该隐藏层的节点个数通常为输入层节点个数的1.2倍至1.5倍，即自变量个数的1.2倍至1.5倍。这里如果将参数值设定为0，则表示建立的模型为无隐藏的人工神经网络模型。
>* rang指的是初始随机权重的范围是[-rang,rang]。通常情况下，该参数的值只有在输入变量很大的情况下才会取到0.5左右，而一般对于确定该参数的值时存在一个公式的，即rang与x的绝对值中的最大值的乘积大约等于1。
>* decay是指在模型建立过程中，模型权重值得衰减精度，即当模型的权重值每次衰减小于该参数值时，模型将不再进行迭代。
>* maxit控制的是模型的最大迭代次数，即在模型迭代过程中，如果一直没有触碰模型迭代停止的其他条件，那么模型将会在迭代达到该最大次数后停止模型迭代，这个参数的设置主要是为了防止模型的死循环或者是一些没必要的迭代。

nnet函数的输出结果
>* 输出结果wts。该结果中包含了在模型迭代过程中所寻找到的最优权重值，我们也可以将其理解为模型的最优系数。
>* 输出结果residuals。该结果包含了训练集的残差值。
>* 输出结果convergence。该结果表示在模型建立的迭代过程中，迭代次数是否达到最大迭代次数。如果结果为1，则表明迭代次数达到最大迭代次数；如果结果为0则表明没有达到最大迭代次数。如果结果达到了最大迭代次数，我们就应该对模型的建立进行进一步分析，因为模型建立过程中是因为达到最大迭代次数才停止迭代的，则说明迭代过程中没有触碰到其他决定模型精度的条件，这就很可能会导致我们建立出来的模型精度并不高，并不是最优模型，所以应考虑是否提高最大迭代次数后再次进行模型估计。   
总的说来，如果模型中的类别变量为一个含有因子的变量，则我们将建立的人工网络模型就是一个分类模型。而如果类别变量不是一个含有因子的变量，则模型将无法建立。    
3.nnetHess函数   
该函数用来估计人工神经网络模型中的黑塞矩阵（即二次导数矩阵）。   
nnetHess(net, x, y, weights)

##应用案例##
###数据处理###
作为建立人工神经网络模型的处理方式主要进行数据的归一化。数据归一化方法是神经网络预测前对数据常做的一种处理方法，即将所有数据都转化为[0,1]之间的数，其目的是取消各维度数据间数量级的差别，避免因为输入输出数据数量级差别较大而造成网络预测误差较大。   
数据归一化的方法主要有以下两种：    
1.最大最小法，函数形式为
x<sub>k</sub>=(x<sub>k</sub>-x<sub>min</sub>)/(x<sub>max</sub>-x<sub>min</sub>)   
x<sub>min</sub>为数据序列中的最小数，x<sub>max</sub>为数据序列中的最大数   
2.平均数方差法，函数形式为
x<sub>k</sub>=(x<sub>k</sub>-x<sub>mean</sub>)/x<sub>var</sub>   
x<sub>mean</sub>为数据序列的均值，x<sub>var</sub>为数据的方差
```r
scale01=function(x){
	ncol<-dim(x)[2]-1 #
	nrow<-dim(x)[1]
	new_scale<-matrix(0,nrow,ncol)
	for(i in 1:ncol){
		max<-max(x[,i])
		min<-min(x[,i])
		for(j in 1:nrow){
			new_scale[j,i]<-(x[j,i]-min)/(max-min)
		}
	}
	new_scale
}
```
###建立模型###
```r
wine<-read.csv("winequality-white.csv",sep = ";")
set.seed(71)
samp<-sample(1:nrow(wine),3000)
wine[samp,1:11]<-scale01(wine[samp,])
```